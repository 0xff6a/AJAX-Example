<!DOCTYPE html>
<html>
<head>
  <script src='https://code.jquery.com/jquery-2.0.3.min.js'></script>
  <script src='lib/Moodsic.js'></script>
  <link rel='stylesheet' type='text/css' href='public/style.css'>
</head>

<body>
  <main>
  </main>

  <template id='dynamic-content'>

    <section class='weather-container'>
      <h1>{{ area }}</h1>
      <h2>{{ weather }}</h2>
      <h3>{{ temperature }}&deg</h3>
    </section>

    <section class='spotify-player'>
     <iframe src="https://embed.spotify.com/?uri={{ playlistUrl }}&theme=white&view=coverart"width="300" height="380" frameborder="0" allowtransparency="true"></iframe>
   </section>

  </template>

  <script type="text/javascript" src="http://l2.io/ip.js?var=ip_address"></script>

  <script src='lib/mustache.js'></script>
  <script>
    $(document).ready(function(){
      
      var url = "http://api.worldweatheronline.com/free/v1/weather.ashx?q=" + ip_address + "&format=json&num_of_days=1&date=today&includelocation=yes&key=42063e760fd51f59cd246ae00690eaa024a131de"

      $.get(url, function(data){

        var moodsic = new Moodsic();
        var weatherDesc = data.data.current_condition[0].weatherDesc[0].value;

        var content = {
          area: data.data.nearest_area[0].areaName[0].value,
          weather: data.data.current_condition[0].weatherDesc[0].value,
          temperature: data.data.current_condition[0].temp_C,
          playlistUrl: moodsic.returnPlaylistUrlFrom(weatherDesc)
        }

        var dynamicContent = Mustache.render($('#dynamic-content').html(), content);
        $(dynamicContent).appendTo('main')
    
        $('body').addClass(weatherDesc.toLowerCase())

      });
    });
    
  </script>

</body>

</html>

